# JD Optimizer - 生产环境检查清单

本文档提供生产环境部署前的完整检查清单，确保应用安全、可靠、高性能地运行。

## 使用说明

- 每个检查项必须完成后打勾 ✓
- 记录完成日期和负责人
- 对于复杂检查，添加备注和链接

---

## 安全检查

### SSL/TLS 配置

- [ ] **HTTPS已启用**
  - [ ] 所有流量通过HTTPS
  - [ ] HTTP自动重定向到HTTPS
  - [ ] SSL证书已颁发（Cloudflare自动颁发）
  - [ ] SSL证书有效期检查（>30天）
  - 负责人: ____________ 日期: ____________

- [ ] **HSTS已配置**
  - [ ] Strict-Transport-Security头已设置
  - [ ] max-age至少设置为31536000（1年）
  - [ ] includeSubDomains已启用
  - 负责人: ____________ 日期: ____________

- [ ] **安全头配置**
  - [ ] X-Frame-Options: DENY 或 SAMEORIGIN
  - [ ] X-Content-Type-Options: nosniff
  - [ ] X-XSS-Protection: 1; mode=block
  - [ ] Content-Security-Policy已配置
  - [ ] Referrer-Policy已配置
  - 负责人: ____________ 日期: ____________

### 环境变量安全

- [ ] **敏感变量保护**
  - [ ] 所有密钥存储在Cloudflare环境变量中
  - [ ] 不在代码中硬编码密钥
  - [ ] API密钥权限最小化
  - [ ] 生产环境密钥与开发环境分离
  - 负责人: ____________ 日期: ____________

- [ ] **密钥轮换计划**
  - [ ] 定期更换API密钥（每90天）
  - [ ] 失效密钥立即撤销
  - [ ] 密钥轮换流程文档化
  - 负责人: ____________ 日期: ____________

### 认证和授权

- [ ] **认证安全**
  - [ ] AUTH_SECRET使用强随机密钥（32字节以上）
  - [ ] 密码哈希使用bcrypt或Argon2
  - [ ] 登录失败次数限制
  - [ ] 会话超时已设置（建议24小时）
  - 负责人: ____________ 日期: ____________

- [ ] **OAuth安全**
  - [ ] OAuth客户端密钥保密
  - [ ] 重定向URL限制
  - [ ] PKCE已启用（如果支持）
  - 负责人: ____________ 日期: ____________

- [ ] **RBAC权限**
  - [ ] 角色权限已正确配置
  - [ ] 管理员角色已分配
  - [ ] 敏感操作需要二次验证
  - 负责人: ____________ 日期: ____________

### 数据安全

- [ ] **数据库安全**
  - [ ] 数据库连接使用SSL/TLS
  - [ ] 数据库用户权限最小化
  - [ ] 敏感字段已加密（如PII数据）
  - 负责人: ____________ 日期: ____________

- [ ] **数据备份**
  - [ ] 自动备份已启用（每日）
  - [ ] 备份已加密存储
  - [ ] 备份恢复流程已测试
  - [ ] 异地备份（至少一个备份在不同区域）
  - 负责人: ____________ 日期: ____________

### API安全

- [ ] **API密钥管理**
  - [ ] OpenRouter API密钥已配置
  - [ ] Stripe密钥已配置（生产环境）
  - [ ] Resend API密钥已配置
  - [ ] Webhook Secret已配置
  - 负责人: ____________ 日期: ____________

- [ ] **速率限制**
  - [ ] API速率限制已启用
  - [ ] DDoS防护已配置（Cloudflare WAF）
  - [ ] IP白名单/黑名单配置
  - 负责人: ____________ 日期: ____________

### 第三方服务安全

- [ ] **Stripe配置**
  - [ ] 生产环境密钥（sk_live_）
  - [ ] Webhook端点已验证
  - [ ] 支付流程已测试
  - 负责人: ____________ 日期: ____________

- [ ] **邮件服务**
  - [ ] Resend域名已验证
  - [ ] SPF/DKIM/DMARC记录已配置
  - [ ] 邮件模板已测试
  - 负责人: ____________ 日期: ____________

---

## 性能检查

### 页面加载性能

- [ ] **Core Web Vitals**
  - [ ] LCP (Largest Contentful Paint) < 2.5s
  - [ ] FID (First Input Delay) < 100ms
  - [ ] CLS (Cumulative Layout Shift) < 0.1
  - [ ] 在Lighthouse中测试通过（分数>90）
  - 负责人: ____________ 日期: ____________

- [ ] **资源优化**
  - [ ] 图片已优化（WebP格式，适当尺寸）
  - [ ] CSS/JS已压缩和合并
  - [ ] 字体加载已优化（preload/prefetch）
  - [ ] 静态资源使用CDN（Cloudflare）
  - 负责人: ____________ 日期: ____________

- [ ] **缓存策略**
  - [ ] 静态资源设置长期缓存（1年）
  - [ ] HTML页面使用短期缓存或禁用缓存
  - [ ] API响应使用合理的缓存头
  - [ ] Cache-Control头已正确设置
  - 负责人: ____________ 日期: ____________

### API响应性能

- [ ] **数据库查询优化**
  - [ ] 索引已正确设置
  - [ ] 慢查询已识别和优化
  - [ ] N+1查询问题已解决
  - [ ] 数据库连接池已配置
  - 负责人: ____________ 日期: ____________

- [ ] **API响应时间**
  - [ ] 平均响应时间 < 200ms
  - [ ] 95th百分位响应时间 < 500ms
  - [ ] API超时已设置（建议30秒）
  - 负责人: ____________ 日期: ____________

### 应用架构性能

- [ ] **Next.js优化**
  - [ ] ISR（增量静态再生）已配置
  - [ ] Server Components已使用
  - [ ] 代码分割已启用
  - [ ] 图片优化使用next/image
  - 负责人: ____________ 日期: ____________

- [ ] **Cloudflare优化**
  - [ ] Edge Functions已配置
  - [ ] Workers缓存已利用
  - [ ] Argo智能路由已启用（可选）
  - 负责人: ____________ 日期: ____________

### 负载测试

- [ ] **压力测试**
  - [ ] 并发用户测试已完成
  - [ ] 峰值负载测试（预计流量的3倍）
  - [ ] 长时间运行测试（24小时）
  - 负责人: ____________ 日期: ____________

- [ ] **扩展性验证**
  - [ ] 自动扩展配置已测试
  - [ ] 数据库连接池扩展性验证
  - 负责人: ____________ 日期: ____________

---

## 监控检查

### 错误追踪

- [ ] **错误监控设置**
  - [ ] Cloudflare Observability已启用
  - [ ] 控制台错误被捕获和上报
  - [ ] 未捕获的异常被处理
  - [ ] 客户端错误被追踪
  - 负责人: ____________ 日期: ____________

- [ ] **告警配置**
  - [ ] 错误率告警已设置（>1%）
  - [ ] 响应时间告警已设置（>1s）
  - [ ] 5xx错误告警已设置
  - [ ] 告警通知已配置（邮件/Slack）
  - 负责人: ____________ 日期: ____________

### Analytics分析

- [ ] **用户分析**
  - [ ] Google Analytics已配置（或Cloudflare Web Analytics）
  - [ ] 用户事件追踪已设置
  - [ ] 转化漏斗已定义
  - [ ] 用户分群已配置
  - 负责人: ____________ 日期: ____________

- [ ] **性能监控**
  - [ ] Lighthouse CI已集成
  - [ ] Real User Monitoring (RUM)已启用
  - [ ] 性能指标仪表板已创建
  - 负责人: ____________ 日期: ____________

### 日志管理

- [ ] **日志收集**
  - [ ] 应用日志已配置
  - [ ] 访问日志已启用
  - [ ] 错误日志已隔离
  - [ ] 日志级别正确设置（生产环境使用warn/error）
  - 负责人: ____________ 日期: ____________

- [ ] **日志保留和搜索**
  - [ ] 日志保留策略已设置（至少30天）
  - [ ] 日志搜索功能已配置
  - [ ] 敏感信息已脱敏
  - 负责人: ____________ 日期: ____________

### 健康检查

- [ ] **健康端点**
  - [ ] /health 端点已实现
  - [ ] 数据库连接检查
  - [ ] 外部服务可用性检查
  - [ ] 健康检查被监控服务调用
  - 负责人: ____________ 日期: ____________

- [ ] **Uptime监控**
  - [ ] 外部uptime监控已配置（如UptimeRobot）
  - [ ] 监控间隔已设置（建议5分钟）
  - [ ] 停机告警已配置
  - 负责人: ____________ 日期: ____________

---

## 备份检查

### 数据库备份

- [ ] **自动备份**
  - [ ] 每日自动备份已启用
  - [ ] 备份时间已设置（低峰期）
  - [ ] 备份保留期限已设置（建议30天）
  - [ ] 备份加密已启用
  - 负责人: ____________ 日期: ____________

- [ ] **备份验证**
  - [ ] 备份完整性已验证
  - [ ] 备份恢复流程已测试
  - [ ] 测试恢复已成功执行
  - [ ] 恢复时间目标（RTO）已定义（<1小时）
  - 负责人: ____________ 日期: ____________

- [ ] **异地备份**
  - [ ] 至少一个备份在不同区域
  - [ ] 跨区域备份已自动化
  - [ ] 异地备份恢复已测试
  - 负责人: ____________ 日期: ____________

### 代码和配置备份

- [ ] **版本控制**
  - [ ] Git备份已配置
  - [ ] 标签（Tags）用于版本标记
  - [ ] 代码仓库备份（GitHub/GitLab）
  - 负责人: ____________ 日期: ____________

- [ ] **配置备份**
  - [ ] wrangler.toml已版本控制
  - [ ] 环境变量文档已更新
  - [ ] 配置变更记录已维护
  - 负责人: ____________ 日期: ____________

### 灾难恢复

- [ ] **灾难恢复计划**
  - [ ] DRP文档已编写
  - [ ] 灾难恢复演练已完成
  - [ ] 恢复优先级已定义
  - [ ] 团队联系方式已更新
  - 负责人: ____________ 日期: ____________

- [ ] **故障转移**
  - [ ] 主备切换流程已文档化
  - [ ] 故障转移时间已测试（<30分钟）
  - 负责人: ____________ 日期: ____________

---

## 功能验证

### 核心功能测试

- [ ] **用户认证**
  - [ ] 用户注册流程
  - [ ] 用户登录流程
  - [ ] 密码重置流程
  - [ ] OAuth登录（Google/GitHub）
  - [ ] 会话管理
  - 负责人: ____________ 日期: ____________

- [ ] **JD优化功能**
  - [ ] AI分析功能
  - [ ] JD编辑器
  - [ ] 模板选择
  - [ ] 导出功能（PDF/Word/Markdown）
  - 负责人: ____________ 日期: ____________

- [ ] **支付功能**
  - [ ] Stripe结账流程
  - [ ] Webhook接收
  - [ ] 订单确认
  - [ ] 收据发送
  - 负责人: ____________ 日期: ____________

- [ ] **邮件功能**
  - [ ] 欢迎邮件
  - [ ] 重置密码邮件
  - [ ] 订单确认邮件
  - 负责人: ____________ 日期: ____________

### 跨浏览器兼容性

- [ ] **浏览器测试**
  - [ ] Chrome (最新版)
  - [ ] Firefox (最新版)
  - [ ] Safari (最新版)
  - [ ] Edge (最新版)
  - [ ] 移动浏览器
  - 负责人: ____________ 日期: ____________

### 移动设备测试

- [ ] **响应式设计**
  - [ ] iOS设备测试
  - [ ] Android设备测试
  - [ ] 触控交互优化
  - [ ] 移动性能测试
  - 负责人: ____________ 日期: ____________

---

## 合规检查

### 数据隐私

- [ ] **GDPR合规**
  - [ ] 隐私政策已发布
  - [ ] Cookie同意横幅已实现
  - [ ] 用户数据删除功能已实现
  - [ ] 数据导出功能已实现
  - 负责人: ____________ 日期: ____________

- [ ] **数据处理**
  - [ ] 数据处理协议已记录
  - [ ] 第三方数据处理协议已签署
  - [ ] 数据保留策略已定义
  - 负责人: ____________ 日期: ____________

### 法律合规

- [ ] **服务条款**
  - [ ] 服务条款已发布
  - [ ] 内容政策已定义
  - [ ] 退款政策已说明
  - 负责人: ____________ 日期: ____________

- [ ] **知识产权**
  - [ ] 开源许可证已识别
  - [ ] 第三方代码使用合规
  - [ ] 版权声明已更新
  - 负责人: ____________ 日期: ____________

---

## 部署后验证

### 最终检查

- [ ] **域名访问**
  - [ ] 主域名可访问
  - [ ] HTTPS正常工作
  - [ ] SSL证书有效
  - 负责人: ____________ 日期: ____________

- [ ] **应用功能**
  - [ ] 所有核心功能正常
  - [ ] 数据库连接正常
  - [ ] 第三方服务集成正常
  - [ ] 邮件发送正常
  - [ ] 支付处理正常
  - 负责人: ____________ 日期: ____________

- [ ] **监控和日志**
  - [ ] 监控仪表板正常
  - [ ] 日志正常记录
  - [ ] 告警测试成功
  - 负责人: ____________ 日期: ____________

- [ ] **文档更新**
  - [ ] 部署文档已更新
  - [ ] 环境变量文档已更新
  - [ ] 故障排查文档已更新
  - [ ] README已更新
  - 负责人: ____________ 日期: ____________

### 发布检查清单确认

- [ ] 所有上述检查项已完成
- [ ] 团队已审阅并批准
- [ ] 发布窗口已确认
- [ ] 回滚计划已准备
- 负责人: ____________ 日期: ____________

---

## 附录

### 常用命令

```bash
# 查看Cloudflare日志
wrangler tail jd-optimizer

# 检查数据库连接
pnpm db:studio

# 运行类型检查
pnpm tsc --noEmit

# 运行代码检查
pnpm lint

# 测试构建
pnpm build:fast
```

### 联系人

- 技术负责人: ____________
- DevOps工程师: ____________
- 安全负责人: ____________
- 项目经理: ____________

### 相关文档

- [部署文档](./DEPLOYMENT.md)
- [GitHub Actions配置](./.github/workflows/deploy.yml)
- [环境变量示例](./.env.example)
- [wrangler配置](./wrangler.toml)

### 更新日志

- **2025-02-09**: 初始版本创建
  - 安全检查
  - 性能检查
  - 监控检查
  - 备份检查
